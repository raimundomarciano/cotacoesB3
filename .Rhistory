library(cotacoesB3)
library(cotacoesB3)
remove.packages("cotacoesB3", lib="~/R/win-library/3.6")
library(cotacoesB3)
lerCotacoesB3(2013)
list.files("./Downloads")
library(cotacoesB3)
lerCotacoesB3()
lerCotacoesB3
c2013 <- lerCotacoesB3(2013)
files <- unzip("./Downloads/COTAHIST_A2013.ZIP")
library(cotacoesB3)
cotacoesB3::lerCotacoesB3(2013)
c2013 <- cotacoesB3::lerCotacoesB3(2013)
c2014 <- cotacoesB3::lerCotacoesB3(2014)
View(c2014)
library(bizdays)
create.calendar(name = "ANBIMA", holidays = holidaysANBIMA, weekdays = c("saturday", "sunday"))
dataInicio = as.Date("2020-04-25")
dataFim = as.Date("2020-05-05")
datas = seq(dataInicio, dataFim, by = "day")
datas
bizseq(from = dataInicio, to = dataFim, cal = "ANBIMA")
bizdays(from = dataInicio, to = dataFim, cal = "ANBIMA")
rm(dataFim)
rm(dataInicio)
rm(datas)
calendarioBR <- function(dataInicio, dataFim){
library(bizdays)
create.calendar(name = "ANBIMA", holidays = holidaysANBIMA, weekdays = c("saturday", "sunday"))
#dataInicio <- as.Date("2020-04-25")
#dataFim <- as.Date("2020-05-05")
datas <- bizseq(from = dataInicio, to = dataFim, cal = "ANBIMA")
return(datas)
}
as.Date("2020-04-25")
calendarioBR("2020-04-25", "2020-05-05")
lerCotacoesB3 <- function(dt, out = "./Downloads", per = "anual"){
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, filename)
}
fileexists <- list.files(out)
fileexists <- paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
files <- paste0('./COTAHIST_A',dt,'.TXT')
}
layoutCotacoes <- read.csv2("layoutCotacoesHistoricas.csv", stringsAsFactors = FALSE)
cotacao <- read.fwf(file = files, widths = layoutCotacoes$tamanho,
col.names = layoutCotacoes$campo, stringsAsFactors = FALSE,
strip.white = TRUE, skip = 1)
cotacao <- cotacao[-nrow(cotacao),]
cotacao$dtPregao <- as.Date(cotacao$dtPregao, "%Y%m%d")
cotacao$dtVencimento <- as.Date(as.character(cotacao$dtVencimento), "%Y%m%d")
cols = c("precoAbertura","precoMax","precoMinimo",
"precoMedio","precoUltimo", "precoOFC",
"precoOFV")
for (coluna in cols){
cotacao[,coluna] <- cotacao[,coluna] / 100
}
return(cotacao)
}
teste <- calendarioBR("2020-04-25", "2020-05-05")
lerCotacoesB3(teste[1], per = "diario")
cot = data.frame()
temp = NULL
for (t in teste){
temp = lerCotacoesB3(t)
cot = rbind(cot, temp)
}
temp = lerCotacoesB3(t, per = "diario")
for (t in teste){
temp = lerCotacoesB3(t, per = "diario")
cot = rbind(cot, temp)
}
cot = data.frame()
temp = NULL
for (t in teste){
temp = lerCotacoesB3(t, per = "diario")
cot = rbind(cot, temp)
}
teste
teste <- calendarioBR("2020-04-25", "2020-05-05")
cot = data.frame()
temp = NULL
for (t in 1:length(teste)){
temp = lerCotacoesB3(teste[t], per = "diario")
cot = rbind(cot, temp)
}
unique(cot$dtPregao)
cot2020 =  data.frame()
for (t in 1:length(teste)){
temp = lerCotacoesB3(teste[t], per = "diario")
cot2020 = rbind(cot2020, temp)
}
View(cot2020)
rm(cot)
out = "./Downloads"
fileexists <- list.files(out)
fileexists <- paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists
dt = "04052020"
fileexists <- paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0('COTAHIST_A',dt,'.TXT') %in% fileexists)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0('COTAHIST_D',dt,'.TXT') %in% fileexists)
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0('COTAHIST_D',dt,'.TXT') %in% fileexists)
per = "diario"
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, filename)
}
dt = "2020-04-05"
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, filename)
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0('COTAHIST_D',dt,'.TXT') %in% fileexists)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0('COTAHIST_D',format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")) %in% fileexists)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0(format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")) %in% fileexists)
out = "./Downloads"
per = "diario"
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
dt = "2020-04-05"
dt = "2020-04-05"
out = "./Downloads"
per = "diario"
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
paste0(format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")) %in% fileexists)
format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT") %in% fileexists)
dt = "2020-05-04"
out = "./Downloads"
per = "diario"
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT") %in% fileexists)
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
if (per == "anual"){
files <- paste0('./COTAHIST_A',dt,'.TXT')
} else if (per == "diario") {
files <- paste0('./COTAHIST_D',dt,'.TXT')
}
}
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
if (per == "anual"){
files <- paste0('./COTAHIST_A',dt,'.TXT')
} else if (per == "diario") {
files <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT")
}
}
layoutCotacoes <- read.csv2("layoutCotacoesHistoricas.csv", stringsAsFactors = FALSE)
cotacao <- read.fwf(file = files, widths = layoutCotacoes$tamanho,
col.names = layoutCotacoes$campo, stringsAsFactors = FALSE,
strip.white = TRUE, skip = 1)
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
if (per == "anual"){
files <- paste0('./COTAHIST_A',dt,'.TXT')
} else if (per == "diario") {
files <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT")
files <- paste0(out, "/", files)
}
}
cotacao <- read.fwf(file = files, widths = layoutCotacoes$tamanho,
col.names = layoutCotacoes$campo, stringsAsFactors = FALSE,
strip.white = TRUE, skip = 1)
cotacao <- cotacao[-nrow(cotacao),]
cotacao$dtPregao <- as.Date(cotacao$dtPregao, "%Y%m%d")
cotacao$dtVencimento <- as.Date(as.character(cotacao$dtVencimento), "%Y%m%d")
cols = c("precoAbertura","precoMax","precoMinimo",
"precoMedio","precoUltimo", "precoOFC",
"precoOFV")
for (coluna in cols){
cotacao[,coluna] <- cotacao[,coluna] / 100
}
View(cotacao)
View(layoutCotacoes)
lerCotacoesB3 <- function(dt, out = "./Downloads", per = "anual"){
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT") %in% fileexists)
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
if (per == "anual"){
files <- paste0('./COTAHIST_A',dt,'.TXT')
} else if (per == "diario") {
files <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT")
files <- paste0(out, "/", files)
}
}
layoutCotacoes <- read.csv2("layoutCotacoesHistoricas.csv", stringsAsFactors = FALSE)
cotacao <- read.fwf(file = files, widths = layoutCotacoes$tamanho,
col.names = layoutCotacoes$campo, stringsAsFactors = FALSE,
strip.white = TRUE, skip = 1)
cotacao <- cotacao[-nrow(cotacao),]
cotacao$dtPregao <- as.Date(cotacao$dtPregao, "%Y%m%d")
cotacao$dtVencimento <- as.Date(as.character(cotacao$dtVencimento), "%Y%m%d")
cols = c("precoAbertura","precoMax","precoMinimo",
"precoMedio","precoUltimo", "precoOFC",
"precoOFV")
for (coluna in cols){
cotacao[,coluna] <- cotacao[,coluna] / 100
}
return(cotacao)
}
lerCotacoesB3("2020-05-04")
lerCotacoesB3("2020-05-04", per = "anual")
lerCotacoesB3 <- function(dt, out = "./Downloads", per = "anual"){
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT") %in% fileexists)
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
if (per == "anual"){
files <- paste0('./COTAHIST_A',dt,'.TXT')
} else if (per == "diario") {
files <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT")
files <- paste0(out, "/", files)
}
}
layoutCotacoes <- read.csv2("layoutCotacoesHistoricas.csv", stringsAsFactors = FALSE)
cotacao <- read.fwf(file = files, widths = layoutCotacoes$tamanho,
col.names = layoutCotacoes$campo, stringsAsFactors = FALSE,
strip.white = TRUE, skip = 1)
cotacao <- cotacao[-nrow(cotacao),]
cotacao$dtPregao <- as.Date(cotacao$dtPregao, "%Y%m%d")
cotacao$dtVencimento <- as.Date(as.character(cotacao$dtVencimento), "%Y%m%d")
cols = c("precoAbertura","precoMax","precoMinimo",
"precoMedio","precoUltimo", "precoOFC",
"precoOFV")
for (coluna in cols){
cotacao[,coluna] <- cotacao[,coluna] / 100
}
return(cotacao)
}
lerCotacoesB3("2020-05-04", per = "anual")
lerCotacoesB3("2020-05-04", per = "diario")
d04 = lerCotacoesB3("2020-05-04", per = "diario")
d13 = lerCotacoesB3("2013", per = "anual")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(cotacoesB3)
?lerCotacoesB3
devtools::document()
?lerCotacoesB3
library(cotacoesB3)
?lerCotacoesB3
?calendarioBR
?calendarioBR
devtools::document()
library(cotacoesB3)
?calendarioBR
?mean
devtools::document()
library(cotacoesB3)
?calendarioBR
lerCotacoesB3 <- function(dt, out = "./Downloads", per = "anual"){
#' Faz o download das cotações referentes a um ou mais dias. Usa o FTP da B3.
#' Dados anuais (per = "anual") estão disponíveis desde 2000
#' A partir de 2016, só há dados diários (usar per = "2016")
if (per == 'anual'){
dt <- as.character(dt)
url <- paste0('http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_A',
dt,'.ZIP')
filename <- paste0(out,'/COTAHIST_A',dt,'.ZIP')
}
if (per == 'diario'){
url <- format(as.Date(dt, format = "%Y-%m-%d"),
"http://bvmf.bmfbovespa.com.br/InstDados/SerHist/COTAHIST_D%d%m%Y.ZIP")
filename <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.ZIP")
filename <- paste0(out, "/", filename)
}
fileexists <- list.files(out)
fileexists <- (paste0('COTAHIST_A',dt,'.ZIP') %in% fileexists |
format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT") %in% fileexists)
if (!fileexists){
download.file(url = url, destfile = filename, mode = "wb")
files <- unzip(zipfile = filename, exdir = out)
} else {
if (per == "anual"){
files <- paste0('./COTAHIST_A',dt,'.TXT')
} else if (per == "diario") {
files <- format(as.Date(dt, format = "%Y-%m-%d"),
"COTAHIST_D%d%m%Y.TXT")
files <- paste0(out, "/", files)
}
}
layoutCotacoes <- read.csv2("layoutCotacoesHistoricas.csv", stringsAsFactors = FALSE)
cotacao <- read.fwf(file = files, widths = layoutCotacoes$tamanho,
col.names = layoutCotacoes$campo, stringsAsFactors = FALSE,
strip.white = TRUE, skip = 1)
cotacao <- cotacao[-nrow(cotacao),]
cotacao$dtPregao <- as.Date(cotacao$dtPregao, "%Y%m%d")
cotacao$dtVencimento <- as.Date(as.character(cotacao$dtVencimento), "%Y%m%d")
cols = c("precoAbertura","precoMax","precoMinimo",
"precoMedio","precoUltimo", "precoOFC",
"precoOFV")
for (coluna in cols){
cotacao[,coluna] <- cotacao[,coluna] / 100
}
return(cotacao)
}
cotacoesB3::lerCotacoesB3("2020-05-05", per = "diario")
library(cotacoesB3)
lerCotacoesB3("2020-05-05", per = "diario")
ct = lerCotacoesB3("2020-05-05", per = "diario")
ct = lerCotacoesB3("2001-05-05", per = "diario")
ct = lerCotacoesB3("2001-01-25", per = "diario")
ct = lerCotacoesB3("2001-01-26", per = "diario")
ct = lerCotacoesB3("2002-01-26", per = "diario")
ct = lerCotacoesB3("2003-01-26", per = "diario")
ct = lerCotacoesB3("2004-01-26", per = "diario")
ct = lerCotacoesB3("2005-01-26", per = "diario")
ct = lerCotacoesB3("2006-01-26", per = "diario")
ct = lerCotacoesB3("2010-01-26", per = "diario")
ct = lerCotacoesB3("2012-01-26", per = "diario")
ct = lerCotacoesB3("2014-01-26", per = "diario")
ct = lerCotacoesB3("2016-01-26", per = "diario")
ct = lerCotacoesB3("2015-01-25", per = "diario")
ct = lerCotacoesB3("2015-01-24", per = "diario")
ct = lerCotacoesB3("2015-01-28", per = "diario")
ct = lerCotacoesB3("2014-01-28", per = "diario")
ct = lerCotacoesB3("2010-01-28", per = "diario")
ct = lerCotacoesB3("2010-01-20", per = "diario")
ct = lerCotacoesB3("2012-01-20", per = "diario")
ct = lerCotacoesB3("2012-01-24", per = "diario")
ct = lerCotacoesB3("2012-01-25", per = "diario")
ct = lerCotacoesB3("2013-01-25", per = "diario")
ct = lerCotacoesB3("2013-01-28", per = "diario")
ct = lerCotacoesB3("2013-01-30", per = "diario")
ct = lerCotacoesB3("2013-06-30", per = "diario")
ct = lerCotacoesB3("2013-10-30", per = "diario")
ct = lerCotacoesB3("2013-12-30", per = "diario")
ct = lerCotacoesB3("2014-01-02", per = "diario")
lerCotacoesB3("2020-07-11", per = "diario")
lerCotacoesB3("2020-07-10", per = "diario")
lerCotacoesB3("2019", per = "anual")
library(cotacoesB3)
devtools::document()
library(cotacoesB3)
?lerCotacoesB3
paste0("./Downloads",'/COTAHIST_A',dt,'.ZIP')
paste0("./Downloads",'/COTAHIST_A',"2019",'.ZIP')
out = "./Downloads"
filename = paste0("./Downloads",'/COTAHIST_A',"2019",'.ZIP')
files <- unzip(zipfile = filename, exdir = out)
filename
out = "./Downloads/"
files <- unzip(zipfile = filename, exdir = out)
out = "./Downloads"
filename = paste0("./Downloads/COTAHIST_A',"2019",'.ZIP')
filename = paste0("./Downloads/COTAHIST_A","2019",'.ZIP')
files <- unzip(zipfile = filename, exdir = out)
lerCotacoesB3("2018")
lerCotacoesB3("2018")
library(cotacoesB3)
lerCotacoesB3(1986)
library(cotacoesB3)
lerCotacoesB3(1986)
library(cotacoesB3)
lerCotacoesB3(1986)
library(cotacoesB3)
lerCotacoesB3
calendarioBR
cotacoesB3
cotacoesB3::
cotacoesB3::calendarioBR
devtools::document()
cotacoesB3::calendarioBR
lerCotacoesB3(1986)
ct = lerCotacoesB3(1986)
ct = lerCotacoesB3(1986)
ct = lerCotacoesB3(1986)
library(cotacoesB3)
devtools::document()
ct = lerCotacoesB3(1986)
warnings()
View(ct)
